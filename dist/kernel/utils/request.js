import e from'./../../ext/@babel/runtime/helpers/esm/defineProperty.js';import t from'./../../ext/axios/index.js';import{LoginMapper as r}from"../../utils/mappers/LoginMapper.js";import{ENV_API_URL as o,ENV_COOKIE_LOGIN_NAME as n}from"../../envVars.js";function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function c(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?a(Object(o),!0).forEach((function(r){e(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var s=o,i=o,l="".concat(i).concat("auth/refresh/"),u=function(e,o,a){var u,m={method:a.method,credentials:"same-origin","Access-Control-Allow-Origin":"*",headers:Object.assign(o&&!a.formData?{Accept:"application/json","Content-Type":"application/json"}:{},(u=localStorage.getItem(n),u?{"Access-Control-Allow-Origin":"*",Authorization:(u=JSON.parse(u)).access_token}:{}),a.headers),name:a.name,url:a.extern?"".concat(a.route):a.public?"".concat(i).concat(a.route):"".concat(s).concat(a.route)};return"post"!==a.method&&"put"!==a.method&&"patch"!==a.method||(m.data=o&&!a.formData?JSON.stringify(a.body):a.body),t(m.url,m).then((function(e){return"login"===a.type&&localStorage.setItem(n,JSON.stringify(c(c({},e.data),{},{username:a.body.username}))),e})).catch((function(e){var o;if(null!=e&&e.response&&401===(null==e||null===(o=e.response)||void 0===o?void 0:o.status))return Promise.resolve(function(e){var o=e.service,a=localStorage.getItem(n);a=JSON.parse(a);var s={method:"post",credentials:"same-origin",headers:{"Access-Control-Allow-Origin":"*"},name:"account:refreshToken",url:l,data:r.refresh(a)};return t(s.url,s).then((function(e){var t=r.hydrate(e.data);return localStorage.removeItem(n),localStorage.setItem(n,JSON.stringify(c(c({},t),{},{username:a.username}))),p(o)})).catch((function(e){localStorage.removeItem(n)}))}({service:a})).then((function(e){return e}));throw e}))},p=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return u.apply(void 0,[s,!0].concat(t))};export{p as requestApi};
