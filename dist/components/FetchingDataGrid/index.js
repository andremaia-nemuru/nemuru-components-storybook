import e from'./../../ext/@babel/runtime/helpers/esm/extends.js';import t from'./../../ext/@babel/runtime/helpers/esm/defineProperty.js';import r from'./../../ext/@babel/runtime/helpers/esm/slicedToArray.js';import o from'./../../ext/@babel/runtime/helpers/esm/objectWithoutProperties.js';import n from"@material-ui/core/styles/useTheme";import i from"@material-ui/core/useMediaQuery";import{makeStyles as a}from"@material-ui/styles";import l,{useState as u,useEffect as s}from"react";import{DataGrid as c}from"@mui/x-data-grid";import d from"./components/CustomToolbar.js";import f from"./components/CustomPagination.js";var m=["columns","fetch","defaultPageNumber","defaultPageSize","defaultOrderBy","defaultOrderDirection","rowsPerPageOptions","showSearch","showExport","showRefresh","filters","onCellClick"];function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function p(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?g(Object(o),!0).forEach((function(r){t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var h={PAGE_NUMBER:0,PAGE_SIZE:10,ORDER_BY:"created_at",ORDER_DIRECTION:"desc",ROWS_PER_PAGE_OPTIONS:[10,25,50,100],SHOW_SEARCH:!1,SHOW_EXPORT:!1,SHOW_REFRESH:!1};function O(t){var g=t.columns,O=t.fetch,S=t.defaultPageNumber,P=t.defaultPageSize,b=t.defaultOrderBy,v=t.defaultOrderDirection,y=t.rowsPerPageOptions,C=t.showSearch,w=t.showExport,E=t.showRefresh,D=t.filters,R=t.onCellClick,_=void 0===R?function(){}:R,M=o(t,m),j=n(),N=j.breakpoints,T=j.palette,B=i(N.down("sm")),G=i(N.down("md")),z={pageNumber:S||h.PAGE_NUMBER,pageSize:P||h.PAGE_SIZE,orderBy:b||h.ORDER_BY,orderDirection:v||h.ORDER_DIRECTION,rowsPerPageOptions:y||h.ROWS_PER_PAGE_OPTIONS},x=u(z),H=r(x,2),I=H[0],k=H[1],A=u({data:[],totalCount:void 0,loading:!0,filters:[]}),J=r(A,2),W=J[0],F=J[1],U=u({searchString:void 0,lastChangeTime:void 0,forcedTimestamp:void 0}),Y=r(U,2),Z=Y[0],Q=Y[1],X=Z.searchString,q=Z.lastChangeTime,K=Z.forcedTimestamp,L=I.pageNumber,V=I.pageSize,$=I.orderBy,ee=I.orderDirection,te=W.loading,re=W.data,oe=a({root:{border:"none",padding:B?"30px 0px":20,"& .MuiDataGrid-columnSeparator":{visibility:"hidden"},"& .MuiDataGrid-columnHeaderTitleContainer":{padding:0},"& .MuiDataGrid-row":{cursor:"pointer"},"& .MuiDataGrid-toolbarContainer":{justifyContent:B?"center":"end",color:T.text.secondary},"& .MuiButton-label":{color:T.text.secondary,fontSize:0},"& .MuiButton-iconSizeSmall > *:first-child":{fontSize:26},"& .MuiButton-startIcon":{margin:0},"& .MuiButton-endIcon":{margin:0},"& .MuiDataGrid-cell":{opacity:te?.25:1,lineHeight:G?"1.43 !important":""},"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-columnHeader:focus":{outline:"none"},"& .MuiSelect-root":{paddingBlock:0,paddingRight:24}}})(),ne=function(e){var t=new Date;Q((function(r){return p(p({},r),{},{searchString:e,lastChangeTime:t})})),F((function(e){return p(p({},e),{},{loading:!0})})),setTimeout((function(){ie(t)}),1e3)};s((function(){var e=D||[];JSON.stringify(e)!==JSON.stringify(W.filters)&&(F((function(t){return p(p({},t),{},{filters:e})})),le({filters:[{wut:""}]}))}),[D]),s((function(){le()}),[]),s((function(){ae()}),[K]);var ie=function(e){Q((function(t){return p(p({},t),{},{forcedTimestamp:e})}))},ae=function(){new Date-q>=1e3&&le()},le=function(e){var t=p(p(p({},W),I),{},{searchString:X,filters:W.filters},e);O(t).then((function(e){F((function(t){return p(p({},t),{},{data:e.data,totalCount:e.totalCount,totalPages:e.totalPages,loading:!1})}))})),F((function(e){return p(p({},e),{},{loading:!0})})),k((function(t){return p(p({},t),e)}))};return l.createElement(c,e({className:oe.root,autoHeight:!0,loading:te,rowHeight:74,disableColumnMenu:!0,disableColumnFilter:!0,columns:g,rows:re,paginationMode:"server",rowCount:null==W?void 0:W.totalCount,rowsPerPageOptions:[10,25,50,100],page:L,pageSize:V,onPageChange:function(e){return le({pageNumber:e})},onPageSizeChange:function(e){return le({pageSize:e})},sortingMode:"server",onSortModelChange:function(e){var t,r,o=e[0];(JSON.stringify($)!==JSON.stringify(null==o?void 0:o.field)||JSON.stringify(ee)!==JSON.stringify(null==o?void 0:o.sort)&&e.length>0)&&le({orderBy:null===(t=e[0])||void 0===t?void 0:t.field,orderDirection:null===(r=e[0])||void 0===r?void 0:r.sort})},sortModel:[{field:$,sort:ee}],pagination:!0,components:{Toolbar:d,Pagination:f},componentsProps:{pagination:{defaultOptions:z,labelRowsPerPage:null,onChange:function(e){return le({pageSize:e})},tableState:W,isMobile:B},toolbar:{value:X,onChange:function(e){return ne(e.target.value)},onClick:function(e){var t;void 0===(t=e)?le():(Q((function(e){return p(p({},e),{},{searchString:t})})),le({searchString:t}))},searchState:Z,showSearch:C,showExport:w,showRefresh:E}},onCellClick:function(e){var t,r;(r=(t=e).colDef.setSearchStringOnCellClick)&&null!==r(t)&&ne(r(t)),_(e)}},M))}export{O as default};
