import e from"../utils.js";import o from"../core/settle.js";import t from"../helpers/cookies.js";import r from"../helpers/buildURL.js";import n from"../core/buildFullPath.js";import s from"../helpers/parseHeaders.js";import a from"../helpers/isURLSameOrigin.js";import i from"../core/createError.js";import l from"../defaults/transitional.js";import u from"../cancel/Cancel.js";var d=function(d){return new Promise((function(p,c){var m,f=d.data,g=d.headers,h=d.responseType;function T(){d.cancelToken&&d.cancelToken.unsubscribe(m),d.signal&&d.signal.removeEventListener("abort",m)}e.isFormData(f)&&delete g["Content-Type"];var E=new XMLHttpRequest;if(d.auth){var v=d.auth.username||"",b=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";g.Authorization="Basic "+btoa(v+":"+b)}var w=n(d.baseURL,d.url);function R(){if(E){var e="getAllResponseHeaders"in E?s(E.getAllResponseHeaders()):null,t={data:h&&"text"!==h&&"json"!==h?E.response:E.responseText,status:E.status,statusText:E.statusText,headers:e,config:d,request:E};o((function(e){p(e),T()}),(function(e){c(e),T()}),t),E=null}}if(E.open(d.method.toUpperCase(),r(w,d.params,d.paramsSerializer),!0),E.timeout=d.timeout,"onloadend"in E?E.onloadend=R:E.onreadystatechange=function(){E&&4===E.readyState&&(0!==E.status||E.responseURL&&0===E.responseURL.indexOf("file:"))&&setTimeout(R)},E.onabort=function(){E&&(c(i("Request aborted",d,"ECONNABORTED",E)),E=null)},E.onerror=function(){c(i("Network Error",d,null,E)),E=null},E.ontimeout=function(){var e=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",o=d.transitional||l;d.timeoutErrorMessage&&(e=d.timeoutErrorMessage),c(i(e,d,o.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",E)),E=null},e.isStandardBrowserEnv()){var C=(d.withCredentials||a(w))&&d.xsrfCookieName?t.read(d.xsrfCookieName):void 0;C&&(g[d.xsrfHeaderName]=C)}"setRequestHeader"in E&&e.forEach(g,(function(e,o){void 0===f&&"content-type"===o.toLowerCase()?delete g[o]:E.setRequestHeader(o,e)})),e.isUndefined(d.withCredentials)||(E.withCredentials=!!d.withCredentials),h&&"json"!==h&&(E.responseType=d.responseType),"function"==typeof d.onDownloadProgress&&E.addEventListener("progress",d.onDownloadProgress),"function"==typeof d.onUploadProgress&&E.upload&&E.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(m=function(e){E&&(c(!e||e&&e.type?new u("canceled"):e),E.abort(),E=null)},d.cancelToken&&d.cancelToken.subscribe(m),d.signal&&(d.signal.aborted?m():d.signal.addEventListener("abort",m))),f||(f=null),E.send(f)}))};export{d as default};
